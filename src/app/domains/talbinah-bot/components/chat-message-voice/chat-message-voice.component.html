<div class="voice-message">
  @if (replay) {
  <div class="voice-message-replay-row">
    <span class="voice-message-replay-icon">
      <span class="voice-message-replay-duration">{{ formatTime(duration) }}</span>
      <span class="voice-message-replay-label">{{ 'general.voiceLabel' | translate }}</span>
      <svg viewBox="-0.01 0 16.021 16.021" xmlns="http://www.w3.org/2000/svg" fill="#000000" width="20" height="20">
        <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
        <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
        <g id="SVGRepo_iconCarrier">
          <g transform="translate(-348 -163.979)" fill="gray">
            <path
              d="M355.5 163.979c-1.412 0-2.5.844-2.5 2.542v5.934c0 1.699 1.088 2.545 2.5 2.545s2.5-.849 2.5-2.545v-5.933c0-1.696-1.088-2.543-2.5-2.543zm0 1c.506 0 .86.141 1.092.36.232.22.408.548.408 1.182v5.934c0 .634-.176.962-.408 1.182-.233.22-.586.363-1.092.363-.506 0-.86-.142-1.092-.361-.232-.22-.408-.548-.408-1.184v-5.933c0-.636.176-.963.408-1.182.232-.22.586-.361 1.092-.361z"
              style="marker:none" color="#000000" overflow="visible"></path>
            <rect height="4" style="marker:none" width="1" x="355" y="175.5" color="#000000" overflow="visible"></rect>
            <path d="M355.5 179c-.833 0-1.668.159-2.5.458V180h5v-.542c-.833-.293-1.667-.458-2.5-.458z"
              style="line-height:125%;-inkscape-font-specification:Ubuntu;text-align:center" font-weight="400"
              font-size="15" font-family="Ubuntu" letter-spacing="0" word-spacing="0" text-anchor="middle"></path>
            <path
              d="M351 171v1.5a4.49 4.49 0 0 0 4.5 4.5 4.49 4.49 0 0 0 4.5-4.5V171h-1v1.5c0 1.939-1.561 3.5-3.5 3.5a3.492 3.492 0 0 1-3.5-3.5V171z">
            </path>
          </g>
        </g>
      </svg>
    </span>

  </div>
  <audio #audioPlayer [src]="safeAudioUrl" preload="metadata"></audio>
  } @else {
  <audio #audioPlayer [src]="safeAudioUrl" preload="metadata"></audio>
  <div class="voice-message__waveform-container">
    <div class="voice-message__waveform" #waveformContainer (click)="seek($event)" (mousedown)="startSeeking($event)">
      <div class="voice-message__waveform-inner">
        <div class="voice-message__waveform-bar" *ngFor="let bar of getWaveformBars(); let i = index"
          [class.voice-message__waveform-bar--active]="isBarActive(i)"></div>
      </div>
      <div class="voice-message__seeker" [style.left.%]="progressPercentage"
        [class.voice-message__seeker--active]="isSeeking"></div>
    </div>

    <div class="voice-message__duration-speed" #speedControl (click)="togglePlaybackSpeed()">
      <span class="voice-message__duration">{{ displayDuration }}</span>
      <span class="voice-message__speed">{{ displaySpeed }}</span>
    </div>
  </div>
  <div class="voice-message__control voice-message__control--play-pause" (click)="togglePlayPause()">
    @if (!isPlaying) {
    <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M4.1772 11.125C3.81626 11.125 3.4736 11.0328 3.17206 10.8484C2.45932 10.4118 2.06641 9.52392 2.06641 8.35465V4.89535C2.06641 3.72123 2.45932 2.83821 3.17206 2.40155C3.8848 1.9649 4.80313 2.04738 5.76258 2.63444L8.58154 4.36166C9.53642 4.94872 10.0664 5.75411 10.0664 6.62743C10.0664 7.50074 9.54099 8.30613 8.58154 8.8932L5.76258 10.6204C5.20975 10.9552 4.67063 11.125 4.1772 11.125Z"
        fill="#0E39B6" />
    </svg>
    }@else {
    <svg width="13" height="13" viewBox="0 0 13 13" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M6.94922 1.375C9.70922 1.375 11.9492 3.615 11.9492 6.375C11.9492 9.135 9.70922 11.375 6.94922 11.375C4.18922 11.375 1.94922 9.135 1.94922 6.375C1.94922 3.615 4.18422 1.375 6.94922 1.375ZM4.81922 6.99C4.81922 7.82 5.48922 8.49 6.31922 8.49H7.54922C8.37922 8.49 9.04922 7.82 9.04922 6.99V5.76C9.04922 4.93 8.37922 4.26 7.54922 4.26H6.31922C5.48922 4.26 4.81922 4.93 4.81922 5.76V6.99Z"
        fill="#0E39B6" />
    </svg>

    }
  </div>
  }
</div>