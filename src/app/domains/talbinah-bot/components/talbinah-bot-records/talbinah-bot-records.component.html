<section class="bot-records" role="region" [attr.aria-label]="'records.yourRecords' | translate">
  <app-dynamic-accordion-item [item]="item">
    <ng-template let-item="item">
      <div class="bot-records__content" [attr.aria-label]="item.title + ' content'">
        <div class="bot-records__search">
          <span class="bot-records__search-icon" aria-hidden="true">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path
                d="M9.58329 17.4998C13.9555 17.4998 17.5 13.9554 17.5 9.58317C17.5 5.21092 13.9555 1.6665 9.58329 1.6665C5.21104 1.6665 1.66663 5.21092 1.66663 9.58317C1.66663 13.9554 5.21104 17.4998 9.58329 17.4998Z"
                stroke="#47586E" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M18.3333 18.3332L16.6666 16.6665" stroke="#47586E" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round" />
            </svg>
          </span>

          <input type="text" class="bot-records__search-input" [placeholder]="'search2' | translate"
            [attr.aria-label]="'search2' | translate" [(ngModel)]="searchQuery" />
        </div>

        <div class="bot-records__chats" [attr.aria-label]="'records.chatRecordsBox' | translate">
          @if (isLoadingHistory()) {
          <div class="bot-records__loading" aria-live="polite">
            <ul class="shimmer-chat-list">
              @for (item of [1, 2]; track $index) {
              <li class="shimmer-chat-item shimmer-wrapper">
                <div class="shimmer-chat-icon shimmer-wrapper"></div>
                <div class="shimmer-chat-info">
                  <div class="shimmer-text-line shimmer-text-line--long shimmer-wrapper"></div>
                  <div class="shimmer-text-line shimmer-text-line--short shimmer-wrapper"></div>
                </div>
              </li>
              }
            </ul>
          </div>
          }
          @else if (filteredChats().length > 0) {
          <div class="bot-records__list-container" role="list" [attr.aria-label]="'records.availableChats' | translate"
            appAutoExactHeight="20" heightMode="max-height">
            @for (chat of filteredChats(); track chat.id) {
            <div class="bot-records__item" [ngClass]="{'selected': chat.selected}" (click)="selectChat(chat)"
              role="listitem button" tabindex="0" [attr.aria-current]="chat.selected ? 'true' : null"
              [attr.aria-label]="(chat.selected ? 'records.selectedChat' : 'records.selectChat') | translate: { chatName: chat.name ?? '', chatDate: (chat.created_at ?? '' | date: 'shortDate') }"
              (keydown.enter)="selectChat(chat)" (keydown.space)="selectChat(chat)">
              <span class="bot-records__chat-icon" aria-hidden="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M7.08337 8.75H12.9167" stroke="#47586E" stroke-width="1.5" stroke-miterlimit="10"
                    stroke-linecap="round" stroke-linejoin="round" />
                  <path
                    d="M5.83329 15.3582H9.16663L12.875 17.8249C13.425 18.1916 14.1666 17.7999 14.1666 17.1332V15.3582C16.6666 15.3582 18.3333 13.6916 18.3333 11.1916V6.19157C18.3333 3.69157 16.6666 2.0249 14.1666 2.0249H5.83329C3.33329 2.0249 1.66663 3.69157 1.66663 6.19157V11.1916C1.66663 13.6916 3.33329 15.3582 5.83329 15.3582Z"
                    stroke="#47586E" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </span>
              <div class="bot-records__chat-info">
                <span class="bot-records__chat-title" [innerHTML]="chat?.highlightedTitle ?? chat.name ?? ''"></span>
                <span class="bot-records__chat-date">
                  {{ 'â€¢ ' + chat.created_at ? (chat.created_at | date: 'EEEE - d MMMM':'':currentLang)
                  : ('____' ) }}
                </span>
              </div>
              @if (chat.selected) {
              <div class="bot-records__chat-actions" aria-hidden="true">
                <app-chat-menu [chatItem]="chat" (click)="$event.stopPropagation()"></app-chat-menu>
              </div>
              }
            </div>
            }
          </div>
          }
          @else if (filteredChats().length == 0) {
          <app-empty-state [config]="chatEmptyState"></app-empty-state>
          }
          @else if (errorMessageHistory() && !status()) {
          <app-error-state [config]="chatsErrorState"></app-error-state>
          }
        </div>
      </div>
    </ng-template>
  </app-dynamic-accordion-item>
</section>