<main class="new-reset-password" role="main">
    <section class="new-reset-password__container">
        <div class="new-reset-password__welcome">
            <p class="new-reset-password__welcome-title">
                {{"general.ChangePassword" | translate}}
            </p>
            <p class="new-reset-password__welcome-description">
                {{"welcome_safe_space" | translate}}
            </p>
        </div>
        <form class="general-form-wrapper" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
            <div class="general-form-wrapper__groups">
                @for (field of formConfig; track $index) {
                <div class="general-form-wrapper__field {{field.widthClass}}">
                    <div class="general-form-wrapper__label-group">
                        @if (field.label) {
                        <label [for]="field.name" class="general-form-wrapper__label" [ngClass]="{
                    'general-form-wrapper__label--error': getError(field.name),
                    'general-form-wrapper__label--clickable':
                      field.enableLabelClick
                    }">
                            {{ field.label | translate }}
                            @if (field.isRequired) {
                            <span class="general-form-wrapper__required">*</span>
                            }
                        </label>
                        }
                    </div>

                    <div class="custom-input-wrapper custom-input-wrapper--with-icon custom-input-wrapper--icon-start"
                        [class.p-invalid]="getError(field.name)">
                        <span class="custom-input-wrapper__icon">
                            <img [src]="field.inputIcon" alt="" />
                        </span>

                        @if (field.name === 'password' || field.name === 'confirmPassword') {
                        <input [id]="field.name" [formControlName]="field.name" [type]="inputType()"
                            [placeholder]="(field.placeholder || '') | translate"
                            [attr.aria-label]="(field.label || '') | translate" class="custom-input-wrapper__input"
                            [disabled]="field.isDisabled ?? false"
                            [attr.autocomplete]="field.name === 'password' ? 'new-password' : 'new-password'" />

                        <button type="button" class="password-toggle-btn" (click)="toggleVisibility()"
                            [attr.aria-label]="passwordVisible() ? ('general.hidePassword' | translate): ('general.showPassword' | translate) ">
                            @if (passwordVisible()) {
                            <app-svg-icon name="eye-slash"></app-svg-icon>
                            }
                            @if (!passwordVisible()) {
                            <app-svg-icon name="eye-open"></app-svg-icon>
                            }
                        </button>
                        } @else {
                        <input [id]="field.name" [formControlName]="field.name" [type]="field.type"
                            [placeholder]="(field.placeholder || '') | translate"
                            [attr.aria-label]="(field.label || '') | translate" class="custom-input-wrapper__input"
                            [disabled]="field.isDisabled ?? false"
                            [attr.autocomplete]="field.name === 'password' ? 'new-password' : 'off'" />
                        }
                    </div>
                    <div class="general-form-wrapper__error-message">
                        @if (getError(field.name)) {
                        <span>{{ getValidationErrorMessage(field.name, field.validation ?? []) | translate }}</span>
                        }
                    </div>
                </div>
                }
                <!-- @if (getFormGroupError() && form.touched) {
          <div class="general-form-wrapper__error-message">
            <span>{{ getFormGroupValidationErrorMessage('passwordMismatch', 'form.confirmPassword.errors.mismatch') |
              translate }}</span>
          </div>
          } -->
            </div>

            <div class="general-form-wrapper__actions">
                <button id="btn" type="submit" class="btn btn--solid" [disabled]="isLoading()"
                    [attr.aria-label]="'general.Change' | translate">
                    <span class="btn__label">
                        @if (isLoading()) {
                        <div class="general-form-wrapper__actions__loading" aria-label="Submit in progress">
                            {{ 'in_progress' | translate }}
                            <span class="dot-loader"></span>
                        </div>
                        }
                        @if (!isLoading()) {
                        {{ 'general.Change' | translate }}
                        }
                    </span>
                </button>
            </div>
        </form>
    </section>
</main>